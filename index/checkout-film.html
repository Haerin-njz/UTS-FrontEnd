<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pemesanan Kursi</title>
  <link rel="stylesheet" href="/style/checkout.css">
</head>
<body>
  <header>
    <span>Pemesanan Kursi Bioskop</span>
  </header>

  <main>
    <div class="container">
      <div class="screen">LAYAR</div>
      <div id="seat-container"></div>

      <div class="info">
        <h3>Kursi Dipilih:</h3>
        <p id="selected-seats">-</p>
      </div>

      <div class="buttons">
        <button id="checkoutBtn" class="checkout">Checkout</button>
        <button id="backBtn" class="back">Kembali ke Jadwal</button>
      </div>
    </div>
  </main>

  <footer>
    <p>Copyright Kelompok 4</p>
  </footer>

  <script>
    // --- ðŸ”„ RESET BOOKING HARIAN OTOMATIS ---
    const today = new Date().toISOString().split("T")[0];
    const lastDate = localStorage.getItem("lastBookingDate");

    if (lastDate !== today) {
      localStorage.removeItem("bookings");
      localStorage.setItem("lastBookingDate", today);
      console.log("Hari baru! Data booking direset otomatis.");
    }

    // --- DATA BOOKING ---
    const bookings = JSON.parse(localStorage.getItem("bookings")) || {
      "12:00": [],
      "14:00": [],
      "16:00": [],
      "18:00": [],
      "20:00": []
    };

    const seatContainer = document.getElementById('seat-container');
    const output = document.getElementById('selected-seats');
    const checkoutBtn = document.getElementById('checkoutBtn');
    const backBtn = document.getElementById('backBtn');

    let selected = [];

    // Ambil parameter dari URL
    const params = new URLSearchParams(window.location.search);
    const jam = params.get("jam") || "12:00";
    const film = params.get("film") || "ONE PIECE FILM RED";

    // --- RENDER KURSI ---
    function renderSeats(jam) {
      seatContainer.innerHTML = "";
      selected = [];
      output.textContent = "-";

      for (let row = 0; row < 5; row++) {
        const rowDiv = document.createElement('div');
        rowDiv.classList.add('row');

        for (let col = 1; col <= 8; col++) {
          const seatId = String.fromCharCode(65 + row) + col;
          const seat = document.createElement('div');
          seat.classList.add('seat');
          seat.textContent = seatId;
          seat.dataset.seat = seatId;

          if (bookings[jam].includes(seatId)) {
            seat.classList.add('booked');
          } else {
            seat.addEventListener('click', () => toggleSeat(seatId, seat));
          }

          rowDiv.appendChild(seat);
        }
        seatContainer.appendChild(rowDiv);
      }
    }

    // --- PILIH / BATALKAN KURSI ---
    function toggleSeat(seatId, seatElem) {
      if (seatElem.classList.contains('selected')) {
        seatElem.classList.remove('selected');
        selected = selected.filter(s => s !== seatId);
      } else {
        seatElem.classList.add('selected');
        selected.push(seatId);
      }
      output.textContent = selected.length ? selected.join(", ") : "-";
    }

    // --- CHECKOUT ---
    checkoutBtn.addEventListener('click', () => {
      if (selected.length === 0) {
        alert("Belum pilih kursi!");
        return;
      }

      // Simpan booking kursi
      bookings[jam] = bookings[jam].concat(selected);
      localStorage.setItem("bookings", JSON.stringify(bookings));

      // Simpan data order ke localStorage
      const orderSummary = {
        film: film,
        jam: jam,
        seats: selected,
        hargaPerTiket: 65000,
        biayaLayanan: 2500,
        promo: 40000,
        tanggal: today
      };
      localStorage.setItem("lastOrder", JSON.stringify(orderSummary));

      // Arahkan ke halaman ringkasan pesanan
      window.location.href = "ringkasan-pesanan.html";
    });

    // --- TOMBOL KEMBALI ---
    backBtn.addEventListener('click', () => {
      window.location.href = "jadwal-film.html";
    });

    // Render awal
    renderSeats(jam);
  </script>
</body>
</html>
